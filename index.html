<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bank PO Mock Test Tracker with Sectional Tests</title>
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"/>
<style>
  /* (All previous styles remain same; omitted for brevity) */
  /* ...copy styles from previous code here as needed... */
</style>
</head>
<body>
<div class="container">
  <header>
    <h1>Bank PO Mock Test Tracker</h1>
    <p class="description">Track your mock test scores, analyze your performance, and identify areas for improvement.</p>
  </header>

  <div class="grid">
    <div class="card">
      <h2>Add New Test Result</h2>
      <form id="mockTestForm" novalidate>
        <input type="hidden" id="editIndex" value="-1" />
        
        <div class="form-group">
          <label for="examName">Exam Name</label>
          <input type="text" id="examName" name="examName" required placeholder="e.g., SBI PO, IBPS PO" />
        </div>
        
        <div class="form-group">
          <label for="testType">Test Type</label>
          <select id="testType" name="testType" required>
            <option value="full-length">Full-Length</option>
            <option value="prelims-sectional">Prelims Sectional</option>
            <option value="mains-sectional">Mains Sectional</option>
          </select>
        </div>
        
        <div class="form-group" id="sectionGroup" style="display:none;">
          <label for="section">Section</label>
          <select id="section" name="section">
            <option value="" disabled selected>Select Section</option>
            <option value="Quantitative">Quantitative</option>
            <option value="Reasoning">Reasoning</option>
            <option value="English">English</option>
            <option value="Current Affairs">Current Affairs</option>
          </select>
        </div>

        <div class="form-group">
          <label for="platform">Test Platform</label>
          <input type="text" id="platform" name="platform" required placeholder="e.g., Testbook, Guidely" />
        </div>
        
        <div class="form-group">
          <label for="date">Test Date</label>
          <input type="date" id="date" name="date" required />
        </div>
        
        <div class="form-group">
          <label for="totalScore">Total Score</label>
          <input type="number" id="totalScore" name="totalScore" min="0" required />
        </div>

        <div class="form-group">
          <label for="quantScore">Quantitative Score</label>
          <input type="number" id="quantScore" name="quantScore" min="0" />
        </div>
        
        <div class="form-group">
          <label for="reasoningScore">Reasoning Score</label>
          <input type="number" id="reasoningScore" name="reasoningScore" min="0" />
        </div>
        
        <div class="form-group">
          <label for="englishScore">English Score</label>
          <input type="number" id="englishScore" name="englishScore" min="0" />
        </div>

        <div class="form-group">
          <label for="currentAffairsScore">Current Affairs Score</label>
          <input type="number" id="currentAffairsScore" name="currentAffairsScore" min="0" />
        </div>
        
        <div class="form-group">
          <label for="percentile">Percentile</label>
          <input type="number" id="percentile" name="percentile" min="0" max="100" step="0.01" required />
        </div>
        
        <div class="form-group">
          <label for="accuracy">Accuracy (%)</label>
          <input type="number" id="accuracy" name="accuracy" min="0" max="100" step="0.01" required />
        </div>
        
        <div class="form-group">
          <label for="timeSpent">Time Spent (minutes)</label>
          <input type="number" id="timeSpent" name="timeSpent" min="0" step="1" placeholder="Optional" />
        </div>
        
        <div class="form-group">
          <label for="notes">Notes (Optional)</label>
          <textarea id="notes" name="notes" rows="3" placeholder="Any additional notes about this test..."></textarea>
        </div>
        
        <div class="action-buttons">
          <button type="submit" id="submitBtn" class="success">
            <i class="fas fa-save"></i> Save Test
          </button>
          <button type="button" id="cancelEditBtn" class="secondary" style="display: none;">
            <i class="fas fa-times"></i> Cancel Edit
          </button>
          <button type="reset" class="secondary">
            <i class="fas fa-undo"></i> Reset Form
          </button>
        </div>
      </form>
    </div>
    
    <!-- (Other sections like Performance Summary, Goal Progress, Test History, etc. remain the same, including Test History table update for new fields) -->

  </div>
</div>

<input type="file" id="importFile" accept=".json,.csv" style="display:none;"/>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
<script>
  // DOM elements
  const form = document.getElementById("mockTestForm");
  const testTypeSelect = document.getElementById("testType");
  const sectionGroup = document.getElementById("sectionGroup");
  const sectionSelect = document.getElementById("section");

  // Score inputs mapping
  const scoreInputs = {
    Quantitative: document.getElementById("quantScore"),
    Reasoning: document.getElementById("reasoningScore"),
    English: document.getElementById("englishScore"),
    "Current Affairs": document.getElementById("currentAffairsScore"),
  };

  // Show/Hide section selector and adjust validation
  function toggleSectionSelector() {
    if (
      testTypeSelect.value === "prelims-sectional" ||
      testTypeSelect.value === "mains-sectional"
    ) {
      sectionGroup.style.display = "block";
      sectionSelect.required = true;

      // Clear all scores and remove required attribute first
      Object.values(scoreInputs).forEach((input) => {
        input.required = false;
        input.value = "";
      });

      // Wait until user selects section to mark appropriate input as required
      sectionSelect.addEventListener("change", updateScoreRequiredField);
      updateScoreRequiredField();

    } else {
      sectionGroup.style.display = "none";
      sectionSelect.required = false;
      sectionSelect.value = "";

      // For full-length test: all scores required
      Object.values(scoreInputs).forEach((input) => {
        input.required = true;
      });
    }
  }

  function updateScoreRequiredField() {
    // Reset required on all
    Object.values(scoreInputs).forEach((input) => {
      input.required = false;
    });
    const selectedSection = sectionSelect.value;
    if (
      selectedSection in scoreInputs &&
      (testTypeSelect.value === "prelims-sectional" ||
        testTypeSelect.value === "mains-sectional")
    ) {
      scoreInputs[selectedSection].required = true;
    }
  }

  // On test type change, update form
  testTypeSelect.addEventListener("change", () => {
    toggleSectionSelector();
  });

  sectionSelect.addEventListener("change", () => {
    updateScoreRequiredField();
  });

  // Initial toggle on page load
  toggleSectionSelector();

  form.addEventListener("submit", (e) => {
    e.preventDefault();

    // Custom validation for sectional scores before submission
    if (testTypeSelect.value !== "full-length") {
      if (!sectionSelect.value) {
        alert("Please select a section for the sectional test.");
        return;
      }
      const requiredInput = scoreInputs[sectionSelect.value];
      if (!requiredInput.value || Number(requiredInput.value) < 0) {
        alert(
          `Please enter a valid score for the selected section: ${sectionSelect.value}`
        );
        requiredInput.focus();
        return;
      }
    } else {
      // For full-length, ensure all scores entered
      for (const [section, input] of Object.entries(scoreInputs)) {
        if (!input.value || Number(input.value) < 0) {
          alert(`Please enter a valid score for ${section}.`);
          input.focus();
          return;
        }
      }
    }

    // Build test record
    const newTest = {
      examName: form.examName.value.trim(),
      testType: form.testType.value,
      section: form.section.value || null,
      platform: form.platform.value.trim(),
      date: form.date.value,
      totalScore: Number(form.totalScore.value),
      quantScore:
        testTypeSelect.value === "full-length"
          ? Number(form.quantScore.value)
          : sectionSelect.value === "Quantitative"
          ? Number(form.quantScore.value)
          : null,
      reasoningScore:
        testTypeSelect.value === "full-length"
          ? Number(form.reasoningScore.value)
          : sectionSelect.value === "Reasoning"
          ? Number(form.reasoningScore.value)
          : null,
      englishScore:
        testTypeSelect.value === "full-length"
          ? Number(form.englishScore.value)
          : sectionSelect.value === "English"
          ? Number(form.englishScore.value)
          : null,
      currentAffairsScore:
        testTypeSelect.value === "full-length"
          ? Number(form.currentAffairsScore.value || 0)
          : sectionSelect.value === "Current Affairs"
          ? Number(form.currentAffairsScore.value)
          : null,
      percentile: Number(form.percentile.value),
      accuracy: Number(form.accuracy.value),
      timeSpent: form.timeSpent.value ? Number(form.timeSpent.value) : null,
      notes: form.notes.value.trim(),
    };

    const editIndex = parseInt(form.editIndex.value);
    if (editIndex >= 0) {
      tests[editIndex] = newTest;
      cancelEdit();
    } else {
      tests.push(newTest);
    }

    localStorage.setItem("mockTests", JSON.stringify(tests));
    form.reset();
    toggleSectionSelector();
    setDefaultDate();
    renderTests();
    updatePlatformFilter();
  });

  // (Rest of the code for rendering tests, editing, deleting, filtering, charts etc remains the same as in previous full code,
  // but updated to handle currentAffairsScore accordingly)

  // Initialize application
  // Insert all previous functions for renderTests, editTest, deleteTest, updateSummary, charts here,
  // ensuring to map and handle currentAffairsScore as a new field similar to others.

  // Due to response length limits, please integrate the previous full code sections accordingly,
  // replacing previous code related to form submission and validation with the above updated logic.

</script>
</body>
</html>
