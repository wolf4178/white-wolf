<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Bank PO Mock Test Tracker</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 20px;
    background: var(--bg-color);
    color: var(--text-color);
    transition: background 0.3s, color 0.3s;
  }
  :root {
    --bg-color: #f0f8ff;
    --text-color: #000;
    --table-bg: #fff;
    --header-bg: #007bff;
  }
  .dark {
    --bg-color: #121212;
    --text-color: #e0e0e0;
    --table-bg: #1e1e1e;
    --header-bg: #1a73e8;
  }
  h1 {
    color: var(--header-bg);
  }
  form {
    background: var(--table-bg);
    padding: 15px;
    border-radius: 8px;
    max-width: 700px;
    margin-bottom: 20px;
  }
  label {
    display: block;
    margin-top: 10px;
  }
  input, select, textarea {
    width: 100%;
    padding: 7px;
    margin-top: 5px;
    border-radius: 4px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    background: var(--table-bg);
    color: var(--text-color);
  }
  button, .action-btn {
    margin-top: 15px;
    background-color: var(--header-bg);
    border: none;
    color: white;
    padding: 8px 12px;
    cursor: pointer;
    border-radius: 4px;
  }
  .action-btn {
    margin: 0 3px;
    padding: 4px 8px;
  }
  button:hover, .action-btn:hover {
    background-color: #0056b3;
  }
  table {
    width: 100%;
    border-collapse: collapse;
    background: var(--table-bg);
    border-radius: 8px;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 8px;
    text-align: center;
  }
  th {
    background-color: var(--header-bg);
    color: white;
    cursor: pointer;
  }
  #summary {
    background: var(--table-bg);
    padding: 15px;
    border-radius: 8px;
    max-width: 700px;
    margin-top: 10px;
  }
  #searchInput {
    width: 100%;
    max-width: 700px;
    padding: 7px;
    margin-bottom: 10px;
    border-radius: 4px;
    border: 1px solid #ccc;
    box-sizing: border-box;
    background: var(--table-bg);
    color: var(--text-color);
  }
  .improved {
    background-color: #d4edda !important;
  }
  #darkModeToggle {
    margin-bottom: 20px;
  }
</style>
</head>
<body>

<h1>Bank PO Mock Test Tracker</h1>

<label><input type="checkbox" id="darkModeToggle" /> Dark Mode</label>

<form id="mockTestForm">
  <input type="hidden" id="editIndex" value="-1" />
  <label for="platform">Test Platform (e.g., Testbook, Guidely)</label>
  <input type="text" id="platform" name="platform" required />

  <label for="date">Test Date</label>
  <input type="date" id="date" name="date" required />

  <label for="totalScore">Total Score</label>
  <input type="number" id="totalScore" name="totalScore" min="0" required />

  <label for="quantScore">Quantitative Score</label>
  <input type="number" id="quantScore" name="quantScore" min="0" required />

  <label for="reasoningScore">Reasoning Score</label>
  <input type="number" id="reasoningScore" name="reasoningScore" min="0" required />

  <label for="englishScore">English Score</label>
  <input type="number" id="englishScore" name="englishScore" min="0" required />

  <label for="percentile">Percentile</label>
  <input type="number" id="percentile" name="percentile" min="0" max="100" step="0.01" required />

  <label for="accuracy">Accuracy (%)</label>
  <input type="number" id="accuracy" name="accuracy" min="0" max="100" step="0.01" required />

  <label for="notes">Notes (optional)</label>
  <textarea id="notes" name="notes" rows="2"></textarea>

  <button type="submit">Save Test</button>
</form>

<input type="text" id="searchInput" placeholder="Search by Platform..." />

<button id="sortDateBtn">Sort by Date ↓</button>
<button id="exportBtn">Export Data</button>
<input type="file" id="importFile" style="display:none" />

<table id="testsTable">
  <thead>
    <tr>
      <th>Platform</th>
      <th>Date</th>
      <th>Total Score</th>
      <th>Quant Score</th>
      <th>Reasoning Score</th>
      <th>English Score</th>
      <th>Percentile</th>
      <th>Accuracy (%)</th>
      <th>Notes</th>
      <th>Actions</th>
    </tr>
  </thead>
  <tbody></tbody>
</table>

<div id="summary">
  <h3>Summary</h3>
  <p id="avgScore">Average Total Score: N/A</p>
  <p id="maxPercentile">Highest Percentile: N/A</p>
  <p id="avgAccuracy">Average Accuracy: N/A</p>
</div>

<script>
  const form = document.getElementById('mockTestForm');
  const editIndexInput = document.getElementById('editIndex');
  const tableBody = document.querySelector('#testsTable tbody');
  const searchInput = document.getElementById('searchInput');
  const avgScoreEl = document.getElementById('avgScore');
  const maxPercentileEl = document.getElementById('maxPercentile');
  const avgAccuracyEl = document.getElementById('avgAccuracy');
  const darkModeToggle = document.getElementById('darkModeToggle');
  const sortDateBtn = document.getElementById('sortDateBtn');
  const exportBtn = document.getElementById('exportBtn');
  const importFile = document.getElementById('importFile');

  let tests = JSON.parse(localStorage.getItem('mockTests')) || [];
  let sortAscending = true;

  // Dark mode toggle
  darkModeToggle.addEventListener('change', () => {
    if (darkModeToggle.checked) {
      document.body.classList.add('dark');
    } else {
      document.body.classList.remove('dark');
    }
  });

  function renderTests(filter = '') {
    tableBody.innerHTML = '';
    const filteredTests = tests
      .filter(t => t.platform.toLowerCase().includes(filter.toLowerCase()))
      .sort((a, b) => sortAscending
        ? new Date(a.date) - new Date(b.date)
        : new Date(b.date) - new Date(a.date));

    for (let i = 0; i < filteredTests.length; i++) {
      const test = filteredTests[i];
      const row = document.createElement('tr');

      // Highlight if totalScore improved over previous test
      let improvedClass = '';
      if (i > 0 && test.totalScore > filteredTests[i - 1].totalScore) {
        improvedClass = 'improved';
      }

      row.className = improvedClass;
      row.innerHTML = `
        <td>${test.platform}</td>
        <td>${test.date}</td>
        <td>${test.totalScore}</td>
        <td>${test.quantScore}</td>
        <td>${test.reasoningScore}</td>
        <td>${test.englishScore}</td>
        <td>${test.percentile}</td>
        <td>${test.accuracy}</td>
        <td>${test.notes ? test.notes.replace(/</g, "&lt;").replace(/>/g, "&gt;") : ''}</td>
        <td>
          <button class="action-btn" onclick="startEdit(${tests.indexOf(test)})">Edit</button>
          <button class="action-btn" onclick="deleteTest(${tests.indexOf(test)})">Delete</button>
        </td>
      `;
      tableBody.appendChild(row);
    }

    updateSummary(filteredTests);
  }

  function updateSummary(data) {
    if (data.length === 0) {
      avgScoreEl.textContent = 'Average Total Score: N/A';
      maxPercentileEl.textContent = 'Highest Percentile: N/A';
      avgAccuracyEl.textContent = 'Average Accuracy: N/A';
      return;
    }
    const avgScore = (data.reduce((sum, t) => sum + t.totalScore, 0) / data.length).toFixed(2);
    const maxPercentile = Math.max(...data.map(t => t.percentile));
    const avgAccuracy = (data.reduce((sum, t) => sum + t.accuracy, 0) / data.length).toFixed(2);

    avgScoreEl.textContent = `Average Total Score: ${avgScore}`;
    maxPercentileEl.textContent = `Highest Percentile: ${maxPercentile}`;
    avgAccuracyEl.textContent = `Average Accuracy: ${avgAccuracy}`;
  }

  form.addEventListener('submit', e => {
    e.preventDefault();
    const testData = {
      platform: form.platform.value.trim(),
      date: form.date.value,
      totalScore: Number(form.totalScore.value),
      quantScore: Number(form.quantScore.value),
      reasoningScore: Number(form.reasoningScore.value),
      englishScore: Number(form.englishScore.value),
      percentile: Number(form.percentile.value),
      accuracy: Number(form.accuracy.value),
      notes: form.notes.value.trim()
    };

    const editIdx = Number(editIndexInput.value);
    if (editIdx === -1) {
      tests.push(testData);
    } else {
      tests[editIdx] = testData;
      editIndexInput.value = -1;
      form.querySelector('button[type="submit"]').textContent = 'Save Test';
    }

    localStorage.setItem('mockTests', JSON.stringify(tests));
    form.reset();
    renderTests(searchInput.value);
  });

  function startEdit(index) {
    const test = tests[index];
    form.platform.value = test.platform;
    form.date.value = test.date;
    form.totalScore.value = test.totalScore;
    form.quantScore.value = test.quantScore;
    form.reasoningScore.value = test.reasoningScore;
    form.englishScore.value = test.englishScore;
    form.percentile.value = test.percentile;
    form.accuracy.value = test.accuracy;
    form.notes.value = test.notes || '';
    editIndexInput.value = index;
    form.querySelector('button[type="submit"]').textContent = 'Update Test';
    window.scrollTo({top: 0, behavior: 'smooth'});
  }

  function deleteTest(index) {
    if (confirm('Are you sure you want to delete this test?')) {
      tests.splice(index, 1);
      localStorage.setItem('mockTests', JSON.stringify(tests));
      renderTests(searchInput.value);
    }
  }

  searchInput.addEventListener('input', () => {
    renderTests(searchInput.value);
  });

  sortDateBtn.addEventListener('click', () => {
    sortAscending = !sortAscending;
    sortDateBtn.textContent = sortAscending ? 'Sort by Date ↓' : 'Sort by Date ↑';
    renderTests(searchInput.value);
  });

  exportBtn.addEventListener('click', () => {
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(tests));
    const dlAnchorElem = document.createElement('a');
    dlAnchorElem.setAttribute("href", dataStr);
    dlAnchorElem.setAttribute("download", "bank_po_mock_tests.json");
    dlAnchorElem.click();
  });

  importFile.addEventListener('change', (event) => {
    const file = event.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = e => {
      try {
        const imported = JSON.parse(e.target.result);
        if (Array.isArray(imported)) {
          tests = imported;
          localStorage.setItem('mockTests', JSON.stringify(tests));
          renderTests(searchInput.value);
          alert('Data imported successfully!');
        } else {
          alert('Invalid data format.');
        }
      } catch (error) {
        alert('Error parsing file: ' + error.message);
      }
    };
    reader.readAsText(file);
  });

  // Add import button functionality
  const importBtn = document.createElement('button');
  importBtn.textContent = 'Import Data';
  importBtn.className = 'action-btn';
  importBtn.style.marginLeft = '10px';
  exportBtn.insertAdjacentElement('afterend', importBtn);
  importBtn.addEventListener('click', () => importFile.click());

  // Initial render
  renderTests();
</script>

</body>
</html>
